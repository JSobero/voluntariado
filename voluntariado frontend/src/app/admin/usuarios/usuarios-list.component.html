<div class="page-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <h1 class="page-title">
        <span class="title-icon">üë•</span>
        Gesti√≥n de Usuarios
      </h1>
      <p class="page-subtitle">Administra todos los usuarios del sistema</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openModal()">
        <span class="btn-icon">‚ûï</span>
        Nuevo Usuario
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-mini-grid">
    <div class="stat-mini-card stat-admin">
      <div class="stat-mini-icon">üë®‚Äçüíº</div>
      <div class="stat-mini-content">
        <p class="stat-mini-value">{{ getUsuariosByRole('ADMIN').length }}</p>
        <p class="stat-mini-label">Administradores</p>
      </div>
    </div>
    <div class="stat-mini-card stat-organizer">
      <div class="stat-mini-icon">üìã</div>
      <div class="stat-mini-content">
        <p class="stat-mini-value">{{ getUsuariosByRole('ORGANIZADOR').length }}</p>
        <p class="stat-mini-label">Organizadores</p>
      </div>
    </div>
    <div class="stat-mini-card stat-volunteer">
      <div class="stat-mini-icon">ü§ù</div>
      <div class="stat-mini-content">
        <p class="stat-mini-value">{{ getUsuariosByRole('VOLUNTARIO').length }}</p>
        <p class="stat-mini-label">Voluntarios</p>
      </div>
    </div>
  </div>

  <!-- Search & Filters -->
  <div class="filters-section">
    <div class="search-container">
      <span class="search-icon">üîç</span>
      <input
        type="text"
        class="search-input"
        placeholder="Buscar por nombre, correo o tel√©fono..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="filterUsuarios()">
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando usuarios...</p>
  </div>

  <!-- Users Table -->
  <div *ngIf="!loading" class="table-card">
    <div class="table-responsive">
      <table class="data-table">
        <thead>
        <tr>
          <th>ID</th>
          <th>Usuario</th>
          <th>Contacto</th>
          <th>Rol</th>
          <th>Estad√≠sticas</th>
          <th>Acciones</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let usuario of filteredUsuarios" class="table-row">
          <td class="id-cell">
            <span class="id-badge">{{ usuario.id }}</span>
          </td>

          <td class="user-cell">
            <div class="user-info">
              <div class="user-avatar" [ngClass]="getRolAvatarClass(usuario.rol.nombre)">
                {{ usuario.nombre.charAt(0).toUpperCase() }}
              </div>
              <div class="user-details">
                <div class="user-name">{{ usuario.nombre }}</div>
                <div class="user-email">{{ usuario.correo }}</div>
              </div>
            </div>
          </td>

          <td class="contact-cell">
            <div class="contact-info">
              <div class="contact-item" *ngIf="usuario.telefono">
                <span class="contact-icon">üì±</span>
                <span>{{ usuario.telefono }}</span>
              </div>
              <div class="contact-item" *ngIf="!usuario.telefono">
                <span class="no-data">Sin tel√©fono</span>
              </div>
            </div>
          </td>

          <td class="role-cell">
              <span [ngClass]="getRolBadgeClass(usuario.rol.nombre)" class="role-badge">
                <span class="role-icon">{{ getRolIcon(usuario.rol.nombre) }}</span>
                <span>{{ usuario.rol.nombre }}</span>
              </span>
          </td>

          <td class="stats-cell">
            <div class="user-stats">
              <div class="stat-item">
                <span class="stat-icon">‚≠ê</span>
                <span class="stat-value">{{ usuario.puntos }}</span>
                <span class="stat-label">pts</span>
              </div>
              <div class="stat-item">
                <span class="stat-icon">‚è±Ô∏è</span>
                <span class="stat-value">{{ usuario.horasAcumuladas }}</span>
                <span class="stat-label">hrs</span>
              </div>
            </div>
          </td>

          <td class="actions-cell">
            <button class="btn-action btn-edit" (click)="openModal(usuario)" title="Editar">
              ‚úèÔ∏è
            </button>
            <button class="btn-action btn-delete" (click)="deleteUsuario(usuario.id!)" title="Eliminar">
              üóëÔ∏è
            </button>
          </td>
        </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div *ngIf="filteredUsuarios.length === 0" class="empty-state">
        <div class="empty-icon">üë•</div>
        <h3>No se encontraron usuarios</h3>
        <p>Intenta con otros t√©rminos de b√∫squeda o crea un nuevo usuario</p>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="modal-header">
        <h2 class="modal-title">
          <span class="modal-icon">{{ editMode ? '‚úèÔ∏è' : '‚ûï' }}</span>
          {{ editMode ? 'Editar Usuario' : 'Nuevo Usuario' }}
        </h2>
        <button class="modal-close" (click)="closeModal()">‚úï</button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">
            <span class="label-text">Nombre Completo</span>
            <span class="label-required">*</span>
          </label>
          <div class="input-with-icon">
            <span class="input-icon">üë§</span>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="currentUsuario.nombre"
              placeholder="Ej: Juan P√©rez"
              required>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">
            <span class="label-text">Correo Electr√≥nico</span>
            <span class="label-required">*</span>
          </label>
          <div class="input-with-icon">
            <span class="input-icon">üìß</span>
            <input
              type="email"
              class="form-input"
              [(ngModel)]="currentUsuario.correo"
              placeholder="usuario@ejemplo.com"
              required>
          </div>
        </div>

        <div class="form-group" *ngIf="!editMode">
          <label class="form-label">
            <span class="label-text">Contrase√±a</span>
            <span class="label-required">*</span>
          </label>
          <div class="input-with-icon">
            <span class="input-icon">üîí</span>
            <input
              type="password"
              class="form-input"
              [(ngModel)]="currentUsuario.password"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              required>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">
            <span class="label-text">Tel√©fono</span>
          </label>
          <div class="input-with-icon">
            <span class="input-icon">üì±</span>
            <input
              type="tel"
              class="form-input"
              [(ngModel)]="currentUsuario.telefono"
              placeholder="+51 999 999 999">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">
            <span class="label-text">Rol del Usuario</span>
            <span class="label-required">*</span>
          </label>
          <select
            class="form-select"
            [(ngModel)]="currentUsuario.rol.nombre"
            required>
            <option value="">Seleccionar rol...</option>
            <option *ngFor="let rol of roles" [value]="rol.nombre">
              {{ rol.nombre }}
            </option>
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">
              <span class="label-text">Puntos</span>
            </label>
            <div class="input-with-icon">
              <span class="input-icon">‚≠ê</span>
              <input
                type="number"
                class="form-input"
                [(ngModel)]="currentUsuario.puntos"
                min="0"
                placeholder="0">
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">
              <span class="label-text">Horas Acumuladas</span>
            </label>
            <div class="input-with-icon">
              <span class="input-icon">‚è±Ô∏è</span>
              <input
                type="number"
                class="form-input"
                [(ngModel)]="currentUsuario.horasAcumuladas"
                step="0.5"
                min="0"
                placeholder="0">
            </div>
          </div>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">
          Cancelar
        </button>
        <button class="btn btn-primary" (click)="saveUsuario()">
          <span class="btn-icon">{{ editMode ? 'üíæ' : '‚ûï' }}</span>
          {{ editMode ? 'Actualizar' : 'Crear' }} Usuario
        </button>
      </div>
    </div>
  </div>
</div>
