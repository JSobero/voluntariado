<div class="eventos-page">

  <section class="hero-section">
    <div class="hero-content">
      <h1>Encuentra tu próximo<br>proyecto de voluntariado</h1>
      <p class="hero-subtitle">Explora cientos de oportunidades para hacer la diferencia en tu comunidad</p>
      <div class="hero-stats">
        <div class="hero-stat">
          <span class="hero-stat-value">{{eventosFiltrados.length}}</span>
          <span class="hero-stat-label">Eventos disponibles</span>
        </div>
      </div>
    </div>
  </section>

  <section class="filters-bar">
    <div class="filters-container">
      <div class="filters-title">Filtrar por categoría</div>
      <div class="filters-chips">

        <button
          class="filter-chip"
          [class.active]="categoriaSeleccionada === null"
          (click)="seleccionarCategoria(null)">

          <i
            class="filter-chip-icon bi"
            [class]="clasesIconoBootstrap['Todas']"
            [style.color]="categoriaSeleccionada === null ? 'white' : getColorCategoria('Todas')">
          </i>
          <span>Todas</span>
        </button>

        <button
          *ngFor="let cat of categorias"
          class="filter-chip"
          [class.active]="categoriaSeleccionada === cat.id"
          (click)="seleccionarCategoria(cat.id)">

          <i
            class="filter-chip-icon bi"
            [class]="clasesIconoBootstrap[cat.nombre] || clasesIconoBootstrap['default']"
            [style.color]="categoriaSeleccionada === cat.id ? 'white' : getColorCategoria(cat.nombre)">
          </i>
          <span>{{cat.nombre}}</span>
        </button>
      </div>
    </div>
  </section>

  <div class="main-content">
    <div class="content-grid">
      <aside class="filters-sidebar">
        <div class="filters-card">
          <h2>Filtros</h2>
          <p class="filters-subtitle">Refina tu búsqueda</p>
          <div class="filter-group">
            <label>Buscar eventos</label>
            <div class="search-box">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
              <input
                type="text"
                [(ngModel)]="searchTerm"
                (input)="aplicarFiltros()"
                placeholder="Buscar por título o descripción...">
            </div>
          </div>
          <div class="filter-divider"></div>
          <div class="filter-group">
            <label>Fecha de inicio</label>
            <input
              type="date"
              class="date-input"
              [(ngModel)]="fechaInicio"
              (change)="aplicarFiltros()">
          </div>
          <div class="filter-group">
            <label>Fecha de fin</label>
            <input
              type="date"
              class="date-input"
              [(ngModel)]="fechaFin"
              (change)="aplicarFiltros()">
          </div>
          <div class="filter-divider"></div>
          <div class="filter-group">
            <label>Ubicación</label>
            <div class="search-box">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              <input
                type="text"
                [(ngModel)]="lugarFilter"
                (input)="aplicarFiltros()"
                placeholder="Lima, Perú">
            </div>
          </div>
          <button class="clear-btn" (click)="limpiarFiltros()">
            Limpiar todos los filtros
          </button>
        </div>
      </aside>

      <main class="events-section">
        <div class="events-header">
          <div class="results-info">
            <h2>Eventos disponibles</h2>
            <p>{{eventosFiltrados.length}} {{eventosFiltrados.length === 1 ? 'resultado' : 'resultados'}} encontrados</p>
          </div>
          <div class="sort-controls">
            <label>Ordenar por:</label>
            <select
              [(ngModel)]="ordenarPor"
              (change)="aplicarOrden()"
              class="sort-select">
              <option value="relevancia">Relevancia</option>
              <option value="fecha-asc">Fecha (próximos)</option>
              <option value="fecha-desc">Fecha (lejanos)</option>
              <option value="puntos">Más puntos</option>
              <option value="cupos">Más cupos</option>
            </select>
          </div>
        </div>

        <div *ngIf="isLoading" class="loading-state">
        </div>
        <div *ngIf="error && !isLoading" class="error-state">
        </div>
        <div *ngIf="!isLoading && !error && eventosFiltrados.length === 0" class="empty-state">
        </div>

        <div *ngIf="!isLoading && !error && eventosFiltrados.length > 0" class="events-grid">
          <article class="event-card" *ngFor="let evento of eventosFiltrados | paginate: { itemsPerPage: itemsPerPage, currentPage: p }">
            <div class="event-image" [style.backgroundImage]="'url(' + evento.imagen + ')'">
              <div class="event-badges">
                <span class="badge badge-points">{{evento.puntosOtorga || 0}} pts</span>

                <span class="badge badge-category">
                  {{ evento.categoria ? evento.categoria.nombre : 'Otras' }}
                </span>
              </div>
            </div>

            <div class="event-content">
              <h3 class="event-title">{{evento.titulo}}</h3>
              <p class="event-organizer">{{evento.organizador?.nombre || 'Organización'}}</p>

              <div class="event-meta">
                <div class="meta-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  <span>Del {{formatearFecha(evento.fechaInicio)}} al {{formatearFecha(evento.fechaFin)}}</span>
                </div>
                <div class="meta-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  <span>Horario flexible</span>
                </div>
                <div class="meta-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                  <span>{{evento.lugar}}</span>
                </div>
              </div>

              <div class="event-description">
                <p>{{evento.descripcion}}</p>
              </div>

              <div class="event-footer">
                <div class="cupos-info">
                  <div class="cupos-bar">
                    <div class="cupos-fill" [style.width.%]="obtenerPorcentajeInscritos(evento)"></div>
                  </div>
                  <span class="cupos-text">
                    <ng-container *ngIf="tieneCupos(evento); else agotado">
                      {{ (evento.cupoMaximo - (evento.inscritos || 0)) }} cupos disponibles
                    </ng-container>
                    <ng-template #agotado>Agotado</ng-template>
                  </span>
                </div>
                <div class="event-actions">
                  <button class="btn-join" (click)="inscribirseEvento(evento.id)" [disabled]="!tieneCupos(evento)">
                    Únete
                  </button>
                  <button class="btn-share" (click)="compartirEvento(evento)">
                    Compartir
                  </button>
                </div>
              </div>
            </div>
          </article>
        </div>
        <div class="controles-paginacion" *ngIf="!isLoading && eventosFiltrados.length > itemsPerPage">
          <pagination-controls
            (pageChange)="p = $event"
            previousLabel="Anterior"
            nextLabel="Siguiente"
            screenReaderPaginationLabel="Paginación"
            screenReaderPageLabel="página"
            screenReaderCurrentLabel="Estás en la página">
          </pagination-controls>
        </div>
      </main>
    </div>
  </div>

  <div
    class="modal-overlay"
    *ngIf="mostrarModal"
    (click)="cerrarModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-icon" [class.error]="modalEsError">
        <i *ngIf="!modalEsError" class="bi bi-check-circle-fill"></i>
        <i *ngIf="modalEsError" class="bi bi-exclamation-triangle-fill"></i>
      </div>
      <h2 class="modal-title">{{ modalTitulo }}</h2>
      <p class="modal-message">{{ modalMensaje }}</p>
      <button
        class="modal-button"
        [class.error-button]="modalEsError"
        (click)="cerrarModal()">
        Entendido
      </button>
    </div>
  </div>

</div>
