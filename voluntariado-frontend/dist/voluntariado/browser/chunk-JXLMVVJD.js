import{a as N}from"./chunk-YHVJXAO3.js";import{a as U}from"./chunk-3A7EVKQ6.js";import{a as z}from"./chunk-YCCDCEVG.js";import{p as T}from"./chunk-TIHFKB6X.js";import{d as R}from"./chunk-MTNAIJ3P.js";import"./chunk-E5QAETHB.js";import"./chunk-3LARRLV4.js";import{Cb as y,Ga as P,La as f,S as C,Sb as E,Tb as w,Wa as d,X as _,Xa as t,Xb as I,Y as b,Ya as n,Za as p,a as M,ab as v,b as O,bb as x,cb as m,hb as S,ib as k,kb as a,lb as u,mb as h,va as r}from"./chunk-G3BCAZWB.js";function F(o,i){if(o&1&&(t(0,"div",6)(1,"div",7)(2,"span",8),a(3),n(),t(4,"span",9),a(5,"Tus Puntos Disponibles"),n()(),t(6,"div",10),p(7,"i",11),t(8,"span",12),a(9),n()()()),o&2){let e=i.ngIf;r(3),h("Hola, ",e.nombre.split(" ")[0]),r(6),u(e.puntos)}}function A(o,i){o&1&&(t(0,"div",13),p(1,"div",14),t(2,"p"),a(3,"Cargando el cat\xE1logo..."),n()())}function D(o,i){o&1&&(t(0,"div",29)(1,"span"),a(2,"AGOTADO"),n()())}function Y(o,i){if(o&1&&(t(0,"div",30)(1,"div",31),p(2,"div",32),n(),t(3,"small",33),a(4," Te faltan "),t(5,"strong"),a(6),n(),a(7," puntos "),n()()),o&2){let e=m().$implicit,s=m(2);r(2),S("width",s.calcularPorcentaje(e.puntosNecesarios),"%"),r(4),u(s.puntosFaltantes(e.puntosNecesarios))}}function $(o,i){if(o&1&&(t(0,"div",34),p(1,"i",35),a(2),n()),o&2){let e=m().$implicit;r(2),h(" \xA1Solo quedan ",e.stock,"! ")}}function q(o,i){if(o&1){let e=v();t(0,"button",36),x("click",function(){_(e);let c=m().$implicit,g=m(2);return b(g.iniciarCanje(c))}),a(1," Canjear Ahora "),n()}}function H(o,i){o&1&&(t(0,"button",37),a(1," Sigue acumulando puntos "),n())}function G(o,i){o&1&&(t(0,"button",38),a(1," No disponible "),n())}function J(o,i){if(o&1&&(t(0,"article",17)(1,"div",18)(2,"div",19),a(3),n(),f(4,D,3,0,"div",20),n(),t(5,"div",21)(6,"h3"),a(7),n(),t(8,"p",22),a(9),n(),f(10,Y,8,3,"div",23)(11,$,3,1,"div",24),n(),t(12,"div",25),f(13,q,2,0,"button",26)(14,H,2,0,"button",27)(15,G,2,0,"button",28),n()()),o&2){let e,s,c,g,l=i.$implicit,j=m(2);k("alcanzable",(((e=j.authService.currentUser())==null?null:e.puntos)||0)>=l.puntosNecesarios)("agotado",l.stock===0),r(),S("background-image","url("+(l.imagenUrl||"assets/images/gift-default.png")+")"),r(2),h(" ",l.puntosNecesarios," pts "),r(),d("ngIf",l.stock===0),r(3),u(l.nombre),r(2),u(l.descripcion),r(),d("ngIf",l.stock>0&&(((s=j.authService.currentUser())==null?null:s.puntos)||0)<l.puntosNecesarios),r(),d("ngIf",l.stock>0&&l.stock<5),r(2),d("ngIf",l.stock>0&&(((c=j.authService.currentUser())==null?null:c.puntos)||0)>=l.puntosNecesarios),r(),d("ngIf",l.stock>0&&(((g=j.authService.currentUser())==null?null:g.puntos)||0)<l.puntosNecesarios),r(),d("ngIf",l.stock===0)}}function B(o,i){if(o&1&&(t(0,"div",15),f(1,J,16,15,"article",16),n()),o&2){let e=m();r(),d("ngForOf",e.recompensas)}}function K(o,i){if(o&1){let e=v();t(0,"div",45)(1,"div",46),p(2,"i",47),n(),t(3,"h2"),a(4,"Confirmar Canje"),n(),t(5,"p"),a(6,"Est\xE1s a punto de canjear:"),n(),t(7,"h3",48),a(8),n(),t(9,"div",49)(10,"div",50)(11,"span"),a(12,"Tus puntos actuales:"),n(),t(13,"strong"),a(14),n()(),t(15,"div",51)(16,"span"),a(17,"Costo del canje:"),n(),t(18,"strong"),a(19),n()(),t(20,"div",52)(21,"span"),a(22,"Te quedar\xE1n:"),n(),t(23,"strong"),a(24),n()()(),t(25,"div",53)(26,"button",54),x("click",function(){_(e);let c=m(2);return b(c.cerrarModal())}),a(27,"Cancelar"),n(),t(28,"button",55),x("click",function(){_(e);let c=m(2);return b(c.confirmarCanje())}),a(29,"\xA1S\xED, canjear!"),n()()()}if(o&2){let e,s,c=m(2);r(8),u(c.recompensaSeleccionada==null?null:c.recompensaSeleccionada.nombre),r(6),u((e=c.authService.currentUser())==null?null:e.puntos),r(5),h("-",c.recompensaSeleccionada==null?null:c.recompensaSeleccionada.puntosNecesarios),r(5),u((((s=c.authService.currentUser())==null?null:s.puntos)||0)-((c.recompensaSeleccionada==null?null:c.recompensaSeleccionada.puntosNecesarios)||0))}}function L(o,i){o&1&&(t(0,"div",56),p(1,"div",57),t(2,"p"),a(3,"Procesando tu canje..."),n()())}function Q(o,i){o&1&&(t(0,"div",58)(1,"div",59),p(2,"i",60),n(),t(3,"h2"),a(4,"\xA1Canje Exitoso!"),n(),t(5,"p"),a(6,"Disfruta tu recompensa. Te hemos enviado un correo con los detalles."),n()())}function W(o,i){if(o&1){let e=v();t(0,"div",61)(1,"div",62),p(2,"i",63),n(),t(3,"h2"),a(4,"Algo sali\xF3 mal"),n(),t(5,"p"),a(6),n(),t(7,"button",64),x("click",function(){_(e);let c=m(2);return b(c.cerrarModal())}),a(8,"Cerrar"),n()()}if(o&2){let e=m(2);r(6),u(e.mensajeError)}}function X(o,i){if(o&1){let e=v();t(0,"div",39),x("click",function(){_(e);let c=m();return b(c.estadoCanje==="procesando"?null:c.cerrarModal())}),t(1,"div",40),x("click",function(c){return _(e),b(c.stopPropagation())}),f(2,K,30,4,"div",41)(3,L,4,0,"div",42)(4,Q,7,0,"div",43)(5,W,9,1,"div",44),n()()}if(o&2){let e=m();r(2),d("ngIf",e.estadoCanje==="confirmando"),r(),d("ngIf",e.estadoCanje==="procesando"),r(),d("ngIf",e.estadoCanje==="exito"),r(),d("ngIf",e.estadoCanje==="error")}}var V=class o{recompensaService=C(U);canjeService=C(N);authService=C(z);router=C(R);recompensas=[];cargando=!0;filtroCategoria="todas";mostrarModal=!1;recompensaSeleccionada=null;estadoCanje="idle";mensajeError="";recompensasFiltradas=y(()=>this.recompensas);ngOnInit(){this.cargarRecompensas(),this.verificarUsuario()}verificarUsuario(){this.authService.currentUser()||this.router.navigate(["/login"])}cargarRecompensas(){this.cargando=!0,this.recompensaService.getAll().subscribe({next:i=>{this.recompensas=i,this.cargando=!1},error:i=>{console.error("Error al cargar recompensas",i),this.cargando=!1}})}iniciarCanje(i){let e=this.authService.currentUser();if(e){if(e.puntos<i.puntosNecesarios){alert("No tienes suficientes puntos para esta recompensa.");return}this.recompensaSeleccionada=i,this.estadoCanje="confirmando",this.mostrarModal=!0}}confirmarCanje(){let i=this.authService.currentUser();if(!i||!this.recompensaSeleccionada)return;this.estadoCanje="procesando";let e={usuario:{id:i.id},recompensa:{id:this.recompensaSeleccionada.id}};this.canjeService.create(e).subscribe({next:s=>{this.estadoCanje="exito";let c=s.puntosUsados||this.recompensaSeleccionada.puntosNecesarios,g=O(M({},i),{puntos:i.puntos-c});this.authService.currentUser.set(g),localStorage.setItem("currentUser",JSON.stringify(g)),this.cargarRecompensas(),setTimeout(()=>{this.cerrarModal()},2e3)},error:s=>{console.error("Error al canjear",s),this.estadoCanje="error",this.mensajeError=s.error?.message||s.message||"Hubo un problema al procesar tu canje. Intenta de nuevo."}})}cerrarModal(){this.mostrarModal=!1,this.recompensaSeleccionada=null,this.estadoCanje="idle"}calcularPorcentaje(i){let e=this.authService.currentUser()?.puntos||0;return e>=i?100:e/i*100}puntosFaltantes(i){let e=this.authService.currentUser()?.puntos||0;return Math.max(0,i-e)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=P({type:o,selectors:[["app-canje-recompensas"]],decls:10,vars:4,consts:[[1,"contenedor-canje"],["class","marcador-puntos",4,"ngIf"],[1,"encabezado-pagina"],["class","loading-state",4,"ngIf"],["class","grid-recompensas",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"marcador-puntos"],[1,"info-usuario"],[1,"hola"],[1,"titulo-puntos"],[1,"puntos-total"],[1,"bi","bi-star-fill","icono-estrella"],[1,"numero-puntos"],[1,"loading-state"],[1,"spinner"],[1,"grid-recompensas"],["class","tarjeta-recompensa",3,"alcanzable","agotado",4,"ngFor","ngForOf"],[1,"tarjeta-recompensa"],[1,"imagen-recompensa"],[1,"badge-costo"],["class","overlay-agotado",4,"ngIf"],[1,"cuerpo-tarjeta"],[1,"descripcion"],["class","progreso-contenedor",4,"ngIf"],["class","info-stock-bajo",4,"ngIf"],[1,"pie-tarjeta"],["class","btn-canjear",3,"click",4,"ngIf"],["class","btn-insuficiente","disabled","",4,"ngIf"],["class","btn-agotado","disabled","",4,"ngIf"],[1,"overlay-agotado"],[1,"progreso-contenedor"],[1,"barra-fondo"],[1,"barra-relleno"],[1,"texto-progreso"],[1,"info-stock-bajo"],[1,"bi","bi-exclamation-circle"],[1,"btn-canjear",3,"click"],["disabled","",1,"btn-insuficiente"],["disabled","",1,"btn-agotado"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],["class","modal-body confirmacion",4,"ngIf"],["class","modal-body procesando",4,"ngIf"],["class","modal-body exito",4,"ngIf"],["class","modal-body error",4,"ngIf"],[1,"modal-body","confirmacion"],[1,"icono-modal"],[1,"bi","bi-gift"],[1,"nombre-premio"],[1,"resumen-puntos"],[1,"fila-resumen"],[1,"fila-resumen","costo"],[1,"fila-resumen","total"],[1,"modal-actions"],[1,"btn-cancelar",3,"click"],[1,"btn-confirmar",3,"click"],[1,"modal-body","procesando"],[1,"spinner-grande"],[1,"modal-body","exito"],[1,"icono-exito"],[1,"bi","bi-check-circle-fill"],[1,"modal-body","error"],[1,"icono-error"],[1,"bi","bi-x-circle-fill"],[1,"btn-cerrar",3,"click"]],template:function(e,s){e&1&&(t(0,"div",0),f(1,F,10,2,"div",1),t(2,"header",2)(3,"h1"),a(4,"Cat\xE1logo de Recompensas"),n(),t(5,"p"),a(6,"Canjea tus puntos por incre\xEDbles premios y experiencias."),n()(),f(7,A,4,0,"div",3)(8,B,2,1,"div",4)(9,X,6,4,"div",5),n()),e&2&&(r(),d("ngIf",s.authService.currentUser()),r(6),d("ngIf",s.cargando),r(),d("ngIf",!s.cargando),r(),d("ngIf",s.mostrarModal))},dependencies:[I,E,w,T],styles:[".contenedor-canje[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:8rem 1rem 2rem;background-color:#f8fafc;min-height:100vh}.marcador-puntos[_ngcontent-%COMP%]{position:sticky;top:80px;z-index:90;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;padding:1rem 1.5rem;border-radius:16px;box-shadow:0 10px 25px -5px #6366f166;display:flex;justify-content:space-between;align-items:center;margin-bottom:4rem;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.info-usuario[_ngcontent-%COMP%]{display:flex;flex-direction:column}.hola[_ngcontent-%COMP%]{font-size:.9rem;opacity:.9}.titulo-puntos[_ngcontent-%COMP%]{font-weight:600;font-size:1.1rem}.puntos-total[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;background:#fff3;padding:.5rem 1rem;border-radius:12px}.icono-estrella[_ngcontent-%COMP%]{color:#fbbf24;font-size:1.5rem}.numero-puntos[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:800;line-height:1}.encabezado-pagina[_ngcontent-%COMP%]{text-align:center;margin-bottom:3rem}.encabezado-pagina[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.5rem;color:#1e293b;margin-bottom:.5rem}.encabezado-pagina[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#64748b;font-size:1.1rem}.grid-recompensas[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:2rem}.tarjeta-recompensa[_ngcontent-%COMP%]{background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 4px 6px -1px #0000001a;transition:transform .3s ease,box-shadow .3s ease;display:flex;flex-direction:column}.tarjeta-recompensa[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 20px 25px -5px #0000001a}.tarjeta-recompensa.alcanzable[_ngcontent-%COMP%]{border:2px solid #8b5cf6}.imagen-recompensa[_ngcontent-%COMP%]{height:200px;background-color:#e2e8f0;background-size:cover;background-position:center;position:relative}.badge-costo[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;background:#000000b3;color:#fbbf24;padding:.5rem 1rem;border-radius:20px;font-weight:700;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.overlay-agotado[_ngcontent-%COMP%]{position:absolute;inset:0;background:#fffc;display:flex;align-items:center;justify-content:center}.overlay-agotado[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#ef4444;color:#fff;padding:.5rem 2rem;font-weight:800;transform:rotate(-5deg);font-size:1.2rem;border-radius:4px}.cuerpo-tarjeta[_ngcontent-%COMP%]{padding:1.5rem;flex-grow:1}.cuerpo-tarjeta[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#1e293b;font-size:1.25rem}.descripcion[_ngcontent-%COMP%]{color:#64748b;font-size:.95rem;line-height:1.5;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}.progreso-contenedor[_ngcontent-%COMP%]{margin-top:1.5rem}.barra-fondo[_ngcontent-%COMP%]{height:8px;background:#e2e8f0;border-radius:4px;overflow:hidden;margin-bottom:.5rem}.barra-relleno[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#f59e0b,#fbbf24);border-radius:4px;transition:width .5s ease-out}.texto-progreso[_ngcontent-%COMP%]{color:#64748b;font-size:.9rem}.texto-progreso[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#f59e0b}.info-stock-bajo[_ngcontent-%COMP%]{margin-top:1rem;color:#dc2626;font-size:.9rem;font-weight:600;display:flex;align-items:center;gap:.5rem}.pie-tarjeta[_ngcontent-%COMP%]{padding:1.5rem;background:#f8fafc;border-top:1px solid #e2e8f0}.pie-tarjeta[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;padding:.75rem;border-radius:10px;border:none;font-weight:700;cursor:pointer;transition:all .2s}.btn-canjear[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff;box-shadow:0 4px 6px -1px #8b5cf64d}.btn-canjear[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 10px 15px -3px #8b5cf666}.btn-insuficiente[_ngcontent-%COMP%]{background:#e2e8f0;color:#94a3b8;cursor:not-allowed}.btn-agotado[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b;cursor:not-allowed}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0009;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:1000;animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:2.5rem;border-radius:24px;width:90%;max-width:450px;box-shadow:0 25px 50px -12px #00000040;animation:_ngcontent-%COMP%_slideUp .3s ease-out;text-align:center}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}.icono-modal[_ngcontent-%COMP%], .icono-exito[_ngcontent-%COMP%], .icono-error[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.icono-modal[_ngcontent-%COMP%]{color:#8b5cf6}.icono-exito[_ngcontent-%COMP%]{color:#10b981}.icono-error[_ngcontent-%COMP%]{color:#ef4444}.nombre-premio[_ngcontent-%COMP%]{color:#8b5cf6;font-size:1.5rem;margin:1rem 0}.resumen-puntos[_ngcontent-%COMP%]{background:#f8fafc;padding:1rem;border-radius:12px;margin:1.5rem 0}.fila-resumen[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.5rem;color:#64748b}.fila-resumen.costo[_ngcontent-%COMP%]{color:#ef4444}.fila-resumen.total[_ngcontent-%COMP%]{border-top:2px solid #e2e8f0;padding-top:.5rem;margin-top:.5rem;color:#1e293b;font-size:1.1rem}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:1rem}.modal-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;padding:.75rem;border-radius:10px;border:none;font-weight:700;cursor:pointer}.btn-cancelar[_ngcontent-%COMP%]{background:#f1f5f9;color:#64748b}.btn-confirmar[_ngcontent-%COMP%]{background:#8b5cf6;color:#fff}.spinner-grande[_ngcontent-%COMP%]{width:50px;height:50px;border:5px solid #e2e8f0;border-top-color:#8b5cf6;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 1rem}@media (max-width: 768px){.marcador-puntos[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}.puntos-total[_ngcontent-%COMP%]{width:100%;justify-content:center}}"]})};export{V as CanjeRecompensasComponent};
