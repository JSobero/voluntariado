import{a as Y}from"./chunk-6YICDHNG.js";import{a as H}from"./chunk-TXX75TQF.js";import{a as B}from"./chunk-XJX4GHT5.js";import"./chunk-E5QAETHB.js";import{b as j,c as D,f as F,i as N,j as U,k as q,p as W}from"./chunk-TIHFKB6X.js";import"./chunk-3LARRLV4.js";import{Aa as M,Ga as k,La as v,Rb as A,Sb as z,Tb as V,Vb as L,Wa as l,X as f,Xa as t,Xb as T,Y as u,Ya as i,Za as s,a as C,ab as E,b as x,bb as g,cb as m,kb as n,lb as _,mb as b,nb as I,ob as h,pb as P,qb as O,sa as w,va as r,vb as y,xb as S}from"./chunk-G3BCAZWB.js";function R(a,o){a&1&&(t(0,"div",12),s(1,"div",13),t(2,"p"),n(3,"Cargando certificados..."),i()())}function J(a,o){if(a&1&&(t(0,"a",41),s(1,"i",42),n(2," Ver PDF "),i()),a&2){let e=m().$implicit;l("href",e.urlPdf,w)}}function K(a,o){a&1&&(t(0,"span",43),n(1,"Sin PDF"),i())}function Q(a,o){if(a&1){let e=E();t(0,"tr",19)(1,"td",20)(2,"span",21),n(3),i()(),t(4,"td",22)(5,"div",23)(6,"div",24),n(7),i(),t(8,"div")(9,"div",25),n(10),i(),t(11,"div",26),n(12),i()()()(),t(13,"td",27)(14,"div")(15,"div",25),n(16),i(),t(17,"div",26),n(18),y(19,"date"),i()()(),t(20,"td",28)(21,"div",29),s(22,"i",30),t(23,"span"),n(24),y(25,"date"),i()(),t(26,"div",31),s(27,"i",32),t(28,"span"),n(29),y(30,"date"),i()()(),t(31,"td",33),v(32,J,3,1,"a",34)(33,K,2,0,"span",35),i(),t(34,"td",36)(35,"button",37),g("click",function(){let c=f(e).$implicit,p=m(2);return u(p.abrirModal(c))}),s(36,"i",38),i(),t(37,"button",39),g("click",function(){let c=f(e).$implicit,p=m(2);return u(p.eliminarCertificado(c.id))}),s(38,"i",40),i()()()}if(a&2){let e=o.$implicit;r(3),_(e.id),r(4),b(" ",e.usuario.nombre.charAt(0)," "),r(3),_(e.usuario.nombre),r(2),_(e.usuario.correo),r(4),_(e.evento.titulo),r(2),_(S(19,10,e.evento.fechaInicio,"dd/MM/yyyy")),r(6),_(S(25,13,e.fechaEmision,"dd/MM/yyyy")),r(5),_(S(30,16,e.fechaEmision,"HH:mm")),r(3),l("ngIf",e.urlPdf),r(),l("ngIf",!e.urlPdf)}}function X(a,o){a&1&&(t(0,"div",44)(1,"div",45),s(2,"i",46),i(),t(3,"h3"),n(4,"No se encontraron certificados"),i(),t(5,"p"),n(6,"Los certificados emitidos aparecer\xE1n aqu\xED."),i()())}function Z(a,o){if(a&1&&(t(0,"div",14)(1,"div",15)(2,"table",16)(3,"thead")(4,"tr")(5,"th"),n(6,"ID"),i(),t(7,"th"),n(8,"Usuario"),i(),t(9,"th"),n(10,"Evento"),i(),t(11,"th"),n(12,"Fecha de Emisi\xF3n"),i(),t(13,"th"),n(14,"PDF"),i(),t(15,"th"),n(16,"Acciones"),i()()(),t(17,"tbody"),v(18,Q,39,19,"tr",17),i()(),v(19,X,7,0,"div",18),i()()),a&2){let e=m();r(18),l("ngForOf",e.certificados),r(),l("ngIf",!e.cargando&&e.certificados.length===0)}}function $(a,o){if(a&1&&(t(0,"option",66),n(1),i()),a&2){let e=o.$implicit;l("value",e.id),r(),I(" ",e.nombre," (",e.correo,") ")}}function ee(a,o){if(a&1&&(t(0,"option",66),n(1),i()),a&2){let e=o.$implicit;l("value",e.id),r(),b(" ",e.titulo," ")}}function te(a,o){if(a&1){let e=E();t(0,"div",47),g("click",function(){f(e);let c=m();return u(c.cerrarModal())}),t(1,"div",48),g("click",function(c){return f(e),u(c.stopPropagation())}),t(2,"div",49)(3,"h2",50),s(4,"i",51),n(5),i(),t(6,"button",52),g("click",function(){f(e);let c=m();return u(c.cerrarModal())}),s(7,"i",53),i()(),t(8,"div",54)(9,"div",55)(10,"label",56),n(11,"Usuario "),t(12,"span",57),n(13,"*"),i()(),t(14,"select",58),O("ngModelChange",function(c){f(e);let p=m();return P(p.certificadoActual.usuarioId,c)||(p.certificadoActual.usuarioId=c),u(c)}),t(15,"option",59),n(16,"Selecciona un usuario..."),i(),v(17,$,2,3,"option",60),i()(),t(18,"div",55)(19,"label",56),n(20,"Evento "),t(21,"span",57),n(22,"*"),i()(),t(23,"select",58),O("ngModelChange",function(c){f(e);let p=m();return P(p.certificadoActual.eventoId,c)||(p.certificadoActual.eventoId=c),u(c)}),t(24,"option",59),n(25,"Selecciona un evento..."),i(),v(26,ee,2,2,"option",60),i()(),t(27,"div",55)(28,"label",56),n(29,"URL del PDF"),i(),t(30,"input",61),O("ngModelChange",function(c){f(e);let p=m();return P(p.certificadoActual.urlPdf,c)||(p.certificadoActual.urlPdf=c),u(c)}),i()()(),t(31,"div",62)(32,"button",63),g("click",function(){f(e);let c=m();return u(c.cerrarModal())}),n(33,"Cancelar"),i(),t(34,"button",64),g("click",function(){f(e);let c=m();return u(c.guardarCertificado())}),s(35,"i",65),n(36),i()()()()}if(a&2){let e=m();r(5),b(" ",e.modoEdicion?"Editar Certificado":"Nuevo Certificado"," "),r(9),h("ngModel",e.certificadoActual.usuarioId),l("disabled",e.modoEdicion),r(),l("ngValue",null),r(2),l("ngForOf",e.listaUsuarios),r(6),h("ngModel",e.certificadoActual.eventoId),l("disabled",e.modoEdicion),r(),l("ngValue",null),r(2),l("ngForOf",e.listaEventos),r(4),h("ngModel",e.certificadoActual.urlPdf),r(4),l("disabled",!e.modoEdicion&&(!e.certificadoActual.usuarioId||!e.certificadoActual.eventoId)),r(),l("ngClass",e.modoEdicion?"bi bi-save-fill":"bi bi-plus-lg"),r(),b(" ",e.modoEdicion?"Actualizar":"Crear Certificado"," ")}}var G=class a{constructor(o,e,d){this.certificadoService=o;this.usuarioService=e;this.eventoService=d}certificados=[];listaUsuarios=[];listaEventos=[];cargando=!1;mostrarModal=!1;modoEdicion=!1;certificadoActual=this.obtenerCertificadoVacio();ngOnInit(){this.cargarCertificados(),this.cargarDatosParaModal()}cargarDatosParaModal(){this.usuarioService.getAll().subscribe(o=>this.listaUsuarios=o),this.eventoService.getAll().subscribe(o=>this.listaEventos=o)}convertirArrayAFecha(o){return Array.isArray(o)?new Date(o[0],o[1]-1,o[2],o[3]||0,o[4]||0,o[5]||0):o}cargarCertificados(){this.cargando=!0,this.certificadoService.getAll().subscribe({next:o=>{this.certificados=o.map(e=>{let d=x(C({},e.evento),{fechaInicio:this.convertirArrayAFecha(e.evento.fechaInicio)});return x(C({},e),{fechaEmision:this.convertirArrayAFecha(e.fechaEmision),evento:d})}),this.cargando=!1},error:o=>{console.error("Error al cargar certificados:",o),this.cargando=!1}})}abrirModal(o){this.mostrarModal=!0,o?(this.modoEdicion=!0,this.certificadoActual=x(C({},o),{usuarioId:o.usuario.id,eventoId:o.evento.id})):(this.modoEdicion=!1,this.certificadoActual=this.obtenerCertificadoVacio())}cerrarModal(){this.mostrarModal=!1}guardarCertificado(){let o={id:this.certificadoActual.id,urlPdf:this.certificadoActual.urlPdf,usuario:{id:this.certificadoActual.usuarioId},evento:{id:this.certificadoActual.eventoId}};if(console.log("Enviando este objeto al backend:",o),!this.modoEdicion&&(!o.usuario.id||!o.evento.id)){alert("Por favor, selecciona un usuario y un evento antes de crear el certificado.");return}this.modoEdicion&&o.id?this.certificadoService.update(o.id,o).subscribe({next:()=>{this.cargarCertificados(),this.cerrarModal()}}):this.certificadoService.create(o).subscribe({next:()=>{this.cargarCertificados(),this.cerrarModal()},error:e=>{console.error("Fall\xF3 la creaci\xF3n del certificado:",e),alert("Hubo un error al crear el certificado. Revisa la consola del backend para m\xE1s detalles.")}})}eliminarCertificado(o){confirm("\xBFEst\xE1 seguro de eliminar este certificado?")&&this.certificadoService.delete(o).subscribe(()=>this.cargarCertificados())}obtenerCertificadoVacio(){return{urlPdf:"",usuarioId:null,eventoId:null}}static \u0275fac=function(e){return new(e||a)(M(Y),M(B),M(H))};static \u0275cmp=k({type:a,selectors:[["app-certificados-list"]],decls:15,vars:3,consts:[[1,"contenedor-pagina"],[1,"encabezado-pagina"],[1,"encabezado-izquierda"],[1,"titulo-pagina"],[1,"icono-titulo","bi","bi-award-fill"],[1,"subtitulo-pagina"],[1,"acciones-encabezado"],[1,"boton","boton-primario",3,"click"],[1,"icono-boton","bi","bi-plus-lg"],["class","contenedor-carga",4,"ngIf"],["class","tarjeta-tabla",4,"ngIf"],["class","modal-superposicion",3,"click",4,"ngIf"],[1,"contenedor-carga"],[1,"giratorio"],[1,"tarjeta-tabla"],[1,"tabla-responsiva"],[1,"tabla-datos"],["class","fila-tabla",4,"ngFor","ngForOf"],["class","estado-vacio",4,"ngIf"],[1,"fila-tabla"],[1,"celda-id"],[1,"insignia-id"],[1,"celda-info-principal"],[1,"info-principal"],[1,"avatar-usuario"],[1,"texto-titulo"],[1,"texto-subtitulo"],[1,"celda-info-secundaria"],[1,"celda-fecha"],[1,"envoltorio-fecha"],[1,"icono-fecha","bi","bi-calendar2-week"],[1,"envoltorio-hora"],[1,"icono-hora","bi","bi-clock"],[1,"celda-enlace"],["target","_blank","class","enlace-pdf",3,"href",4,"ngIf"],["class","texto-deshabilitado",4,"ngIf"],[1,"celda-acciones"],["title","Editar",1,"boton-accion","boton-editar",3,"click"],[1,"bi","bi-pencil-fill"],["title","Eliminar",1,"boton-accion","boton-eliminar",3,"click"],[1,"bi","bi-trash-fill"],["target","_blank",1,"enlace-pdf",3,"href"],[1,"bi","bi-file-earmark-pdf-fill"],[1,"texto-deshabilitado"],[1,"estado-vacio"],[1,"icono-vacio"],[1,"bi","bi-award"],[1,"modal-superposicion",3,"click"],[1,"modal-contenedor",3,"click"],[1,"modal-encabezado"],[1,"modal-titulo"],[1,"icono-modal","bi","bi-award-fill"],[1,"cerrar-modal",3,"click"],[1,"bi","bi-x-lg"],[1,"modal-cuerpo"],[1,"grupo-formulario"],[1,"etiqueta-formulario"],[1,"etiqueta-requerido"],[1,"selector-formulario",3,"ngModelChange","ngModel","disabled"],["disabled","",3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["type","url","placeholder","https://ejemplo.com/certificado.pdf",1,"entrada-formulario",3,"ngModelChange","ngModel"],[1,"modal-pie"],[1,"boton","boton-secundario",3,"click"],[1,"boton","boton-primario",3,"click","disabled"],[1,"icono-boton",3,"ngClass"],[3,"value"]],template:function(e,d){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),s(4,"i",4),n(5," Gesti\xF3n de Certificados "),i(),t(6,"p",5),n(7,"Administra todos los certificados emitidos"),i()(),t(8,"div",6)(9,"button",7),g("click",function(){return d.abrirModal()}),s(10,"i",8),n(11," Nuevo Certificado "),i()()(),v(12,R,4,0,"div",9)(13,Z,20,2,"div",10)(14,te,37,13,"div",11),i()),e&2&&(r(12),l("ngIf",d.cargando),r(),l("ngIf",!d.cargando),r(),l("ngIf",d.mostrarModal))},dependencies:[T,A,z,V,W,U,q,j,N,D,F,L],styles:[".encabezado-pagina[_ngcontent-%COMP%], .boton-secundario[_ngcontent-%COMP%], .boton-secundario[_ngcontent-%COMP%]:hover, .contenedor-carga[_ngcontent-%COMP%], .estado-vacio[_ngcontent-%COMP%], .giratorio[_ngcontent-%COMP%], .tarjeta-tabla[_ngcontent-%COMP%], .tabla-datos[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%], .tabla-datos[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%], .insignia-id[_ngcontent-%COMP%], .boton-accion[_ngcontent-%COMP%], .boton-editar[_ngcontent-%COMP%]:hover, .boton-eliminar[_ngcontent-%COMP%]:hover, .enlace-pdf[_ngcontent-%COMP%], .modal-contenedor[_ngcontent-%COMP%], .modal-encabezado[_ngcontent-%COMP%], .cerrar-modal[_ngcontent-%COMP%], .cerrar-modal[_ngcontent-%COMP%]:hover, .modal-pie[_ngcontent-%COMP%], .entrada-formulario[_ngcontent-%COMP%], .selector-formulario[_ngcontent-%COMP%], .entrada-formulario[_ngcontent-%COMP%]:focus, .selector-formulario[_ngcontent-%COMP%]:focus{transition:background-color .2s ease-in-out,color .2s ease-in-out,border-color .2s ease-in-out}.contenedor-pagina[_ngcontent-%COMP%]{padding:2rem;max-width:1400px;margin:0 auto}.encabezado-pagina[_ngcontent-%COMP%]{background:var(--color-tarjeta);border-radius:16px;padding:2rem;margin-bottom:1.5rem;box-shadow:0 1px 3px #00000014;display:flex;justify-content:space-between;align-items:center;gap:2rem}.encabezado-izquierda[_ngcontent-%COMP%]{flex:1}.titulo-pagina[_ngcontent-%COMP%]{font-size:2rem;font-weight:800;color:var(--color-texto-principal);margin:0 0 .5rem;display:flex;align-items:center;gap:.75rem}.icono-titulo[_ngcontent-%COMP%]{font-size:2.25rem;color:var(--color-texto-principal)}.subtitulo-pagina[_ngcontent-%COMP%]{font-size:1rem;color:var(--color-texto-secundario);margin:0}.acciones-encabezado[_ngcontent-%COMP%]{display:flex;gap:1rem}.boton[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border-radius:10px;font-weight:600;font-size:.875rem;cursor:pointer;border:none;display:inline-flex;align-items:center;gap:.5rem}.boton-primario[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;box-shadow:0 4px 12px #3b82f64d}.boton-primario[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 20px #3b82f666}.contenedor-carga[_ngcontent-%COMP%], .estado-vacio[_ngcontent-%COMP%]{background:var(--color-tarjeta);border-radius:16px;padding:4rem 2rem;text-align:center;box-shadow:0 1px 3px #00000014}.giratorio[_ngcontent-%COMP%]{width:48px;height:48px;border:4px solid var(--color-borde);border-top-color:var(--primary);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin:0 auto 1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.contenedor-carga[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .estado-vacio[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color-texto-secundario);font-size:.875rem;margin:0}.icono-vacio[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;opacity:.5;color:var(--color-texto-secundario)}.estado-vacio[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:var(--color-texto-principal);margin:0 0 .5rem}.tarjeta-tabla[_ngcontent-%COMP%]{background:var(--color-tarjeta);border-radius:16px;box-shadow:0 1px 3px #00000014;overflow:hidden}.tabla-responsiva[_ngcontent-%COMP%]{overflow-x:auto}.tabla-datos[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.tabla-datos[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:var(--color-fondo-input);border-bottom:2px solid var(--color-borde)}.tabla-datos[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem 1.5rem;text-align:left;font-size:.75rem;font-weight:700;color:var(--color-texto-secundario);text-transform:uppercase;letter-spacing:.05em}.tabla-datos[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-borde-divisor)}.tabla-datos[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:var(--color-fondo-hover)}.tabla-datos[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1.25rem 1.5rem;font-size:.875rem;vertical-align:middle}.celda-id[_ngcontent-%COMP%]{width:80px}.insignia-id[_ngcontent-%COMP%]{display:inline-flex;padding:.25rem .75rem;background:var(--color-fondo-hover);color:var(--color-texto-secundario);border-radius:6px;font-weight:600}.celda-fecha[_ngcontent-%COMP%]{min-width:150px}.envoltorio-fecha[_ngcontent-%COMP%], .envoltorio-hora[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:var(--color-texto-secundario)}.envoltorio-fecha[_ngcontent-%COMP%]{margin-bottom:.25rem}.icono-fecha[_ngcontent-%COMP%], .icono-hora[_ngcontent-%COMP%]{font-size:.875rem}.celda-acciones[_ngcontent-%COMP%]{width:120px;text-align:center}.boton-accion[_ngcontent-%COMP%]{padding:.5rem;background:transparent;border:none;cursor:pointer;font-size:1.125rem;border-radius:6px;margin:0 .25rem;color:var(--color-texto-secundario)}.boton-accion[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.boton-editar[_ngcontent-%COMP%]:hover{background:var(--color-acento-sutil);color:var(--color-acento-sutil-texto)}.boton-eliminar[_ngcontent-%COMP%]:hover{background:var(--color-danger-sutil);color:var(--color-danger-sutil-texto)}.celda-info-principal[_ngcontent-%COMP%], .celda-info-secundaria[_ngcontent-%COMP%]{min-width:250px}.info-principal[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center}.avatar-usuario[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1rem;flex-shrink:0}.texto-titulo[_ngcontent-%COMP%]{font-weight:600;color:var(--color-texto-principal)}.texto-subtitulo[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--color-texto-secundario)}.celda-enlace[_ngcontent-%COMP%]{min-width:120px}.enlace-pdf[_ngcontent-%COMP%]{color:var(--primary);font-weight:600;text-decoration:none}.enlace-pdf[_ngcontent-%COMP%]:hover{color:var(--primary-dark);text-decoration:underline}.texto-deshabilitado[_ngcontent-%COMP%]{color:var(--color-texto-secundario);opacity:.7;font-style:italic}.modal-superposicion[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0f172a80;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:1000;padding:1rem}.modal-contenedor[_ngcontent-%COMP%]{background:var(--color-tarjeta);border-radius:16px;width:100%;max-width:500px;box-shadow:0 25px 50px -12px #00000040;animation:_ngcontent-%COMP%_modalSlideIn .3s ease-out;display:flex;flex-direction:column}@keyframes _ngcontent-%COMP%_modalSlideIn{0%{opacity:0;transform:translateY(-20px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}.modal-encabezado[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid var(--color-borde-divisor);display:flex;justify-content:space-between;align-items:center}.modal-titulo[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:var(--color-texto-principal);margin:0;display:flex;align-items:center;gap:.75rem}.icono-modal[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--primary)}.cerrar-modal[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:8px;background:var(--color-fondo-hover);border:none;cursor:pointer;font-size:1.25rem;color:var(--color-texto-secundario)}.cerrar-modal[_ngcontent-%COMP%]:hover{background:var(--color-borde);color:var(--color-texto-principal);transform:rotate(90deg)}.modal-cuerpo[_ngcontent-%COMP%]{padding:1.5rem;overflow-y:auto}.modal-pie[_ngcontent-%COMP%]{padding:1.5rem;border-top:1px solid var(--color-borde-divisor);display:flex;justify-content:flex-end;gap:1rem;background-color:var(--color-fondo-input);border-bottom-left-radius:16px;border-bottom-right-radius:16px}.grupo-formulario[_ngcontent-%COMP%]{margin-bottom:1.25rem}.etiqueta-formulario[_ngcontent-%COMP%]{display:block;font-weight:600;color:var(--color-texto-etiqueta);font-size:.875rem;margin-bottom:.5rem}.etiqueta-requerido[_ngcontent-%COMP%]{color:var(--danger);margin-left:.25rem}.entrada-formulario[_ngcontent-%COMP%], .selector-formulario[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;border:1px solid var(--color-borde);border-radius:8px;font-size:.875rem;background-color:var(--color-fondo-input);color:var(--color-texto-principal)}.entrada-formulario[_ngcontent-%COMP%]:focus, .selector-formulario[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px #3b82f633;background-color:var(--color-tarjeta)}.boton-secundario[_ngcontent-%COMP%]{background:var(--color-tarjeta);color:var(--color-texto-secundario);border:1px solid var(--color-borde)}.boton-secundario[_ngcontent-%COMP%]:hover{background:var(--color-fondo-hover)}.boton[disabled][_ngcontent-%COMP%]{background:var(--color-borde);color:var(--color-texto-secundario);opacity:.7;cursor:not-allowed;transform:none;box-shadow:none}"]})};export{G as CertificadosListComponent};
